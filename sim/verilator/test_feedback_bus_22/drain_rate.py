import sys
sys.path.insert(0,"../../../../python-osi")
sys.path.insert(0,"../../../scripts")
from sigmath import *
from subcarrier_math import *

from numpy.fft import ifft, fft, fftshift


def _signed_value(value, bit_count):
    if value > 2**(bit_count - 1) - 1:
        value -= 2**bit_count 

    return value



def _load_hex_file(filepath):
    with open(filepath) as bootprogram:
        lines = bootprogram.readlines()

    words = [int(l,16) for l in lines]

    rf = []
    for w in words:
        real = _signed_value(w&0xffff, 16)
        imag = _signed_value((w >> 16) & 0xffff, 16)
        rf.append(np.complex(real,imag))
        # print "r", real, " i ", imag
        # print rf[0]
        # sys.exit(0)
    return rf



#        4729 187121236
#     f: 5796 187121672
#     f: 5337 187122163
#     f: 4876 187122639
#     f: 4396 187123118
#     f: 3916 187123587
#     f: 3452 187124089
#     f: 2996 187124555
#     f: 2516 187125035
#     f: 2036 187125517
#     f: 1557 187126021
#     f: 1116 187126489
#     f: 636 187126960
#     f: 156 187127447


y = [
187121236,
187121672,
187122163,
187122639,
187123118,
187123587,
187124089,
187124555,
187125035,
187125517,
187126021,
187126489,
187126960,
187127447
]


x = [
4729,
5796,
5337,
4876,
4396,
3916,
3452,
2996,
2516,
2036,
1557,
1116,
636,
156
]




y = [
49864236,
49864653,
49865244,
49865919,
49984737,
49985259,
49985721,
49986210,
49986696,
49987186,
49987665,
49988145,
49988633,
49989100,
49989608,
49990072,
49990552,
49991072,
49991522,
49992004,
49992469,
49992960,
49993440,
49993916,
49994421,
49994872,
49995409,
49995872,
49996368,
49996806,
49997761,
49998248,
49998724,
49999229,
49999702,
50000165,
50000667,
50001158,
50001614,
50002103,
50002588,
50003203,
50003560,
50004043,
50007555,
50007781,
50007979,
50008214,
50008500,
50008716,
50008923,
50009072,
50009230,
50009363,
50009627,
50009835,
50010284,
50010756,
50011258,
50011716,
50012205,
50012675,
50013162,
50013644,
50014118,
50014616
]

x = [
3538,
3058,
2618,
2138,
6709,
6596,
6136,
5676,
5196,
4716,
4252,
3796,
3683,
3937,
3828,
3823,
4005,
3892,
3779,
3706,
3960,
3847,
3734,
4028,
3915,
3802,
4056,
3605,
3870,
3757,
3906,
3825,
3712,
3966,
3856,
3780,
4034,
3921,
3814,
4102,
3622,
3876,
3766,
4057,
3944,
3831,
4085,
4012,
3899,
3786,
3673,
3967,
3854,
3741,
3995,
3922,
3809,
3829,
3349,
2902,
2429,
1949,
1469,
1009,
549 ,
69  
]


















y1 = 187121672.0
y2 = 187127447.0

x1 = 5796.0
x2 = 156.0


slope = (x1-x2) / (y2-y1)

print("slope", slope)


nplotmulti([y],[x],["x"]);
nplotshow()